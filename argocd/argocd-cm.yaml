apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
  name: argocd-cm
  namespace: argocd
data:
  resource.customizations.actions.skiperator.kartverket.no_Application: |
    discovery.lua: |
      actions = {}
      actions["Stop"] = {["disabled"] = false}
      actions["Start"] = {["disabled"] = false}

      local stop = false
      if obj.spec.replicas == 0 then
        stop = true
      end
      if stop then
        actions["Stop"]["disabled"] = true
      else
        actions["Start"]["disabled"] = true
      end

      return actions
    definitions:
    - name: Stop
      action.lua: |
        obj.spec.replicas = 0
        return obj
    - name: Start
      action.lua: |
        obj.spec.replicas = nil
        return obj
