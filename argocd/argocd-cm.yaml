apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
  name: argocd-cm
  namespace: argocd
data:
  resource.customizations.actions.skiperator.kartverket.no_Application: |
    discovery.lua: |
      actions = {}
      actions["Stop"] = {["disabled"] = false}

      if obj.spec.replicas == 0 then
        actions["Stop"]["disabled"] = true
      end

      return actions
    definitions:
    - name: Stop
      action.lua: |
        obj.spec.replicas = 0
        if obj.metadata.annotations ~= nil then
          obj.metadata.annotations = {["skip.kartverket.no/k8sReplicaLimits"] = "ignore"}
        else
          obj.metadata.annotations["skip.kartverket.no/k8sReplicaLimits"] = "ignore"
        end
        return obj
